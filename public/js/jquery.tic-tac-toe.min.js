/*!
 *  jQuery Tic Tac Toe JavaScript Library
 *  Acts on HTML 3X3 table.
 *  
 *  Responds with countermove after each user move.
 *
 *  @version 0.0.1
 *  @author Richard Royal
 */
(function(e){e.fn.Tic_Tac_Toe=function(){function s(s){e("table.game").hide(),e(".results").show(),e(".results").append("<p class='game-end'>"+s+"</p>"),e(".results").append("<p class='new-game'><br /><a href='.'>New Game?</a></p>"),t(),a()}function t(){e.getJSON("/results/data/global.json",function(s){var t=e("#global_doughnut").get(0).getContext("2d");new Chart(t).Doughnut(s),e(".charts .global").append('<p class="wins">Wins: '+s[0].value+"</p>"),e(".charts .global").append('<p class="ties">Ties: '+s[2].value+"</p>"),e(".charts .global").append('<p class="losses">Losses: '+s[1].value+"</p>")})}function a(){var s=e.cookie("ttt-rr");void 0!==s&&e.getJSON("/results/data/user.json?user_id="+s,function(s){var t=e("#user_doughnut").get(0).getContext("2d");new Chart(t).Doughnut(s),e(".charts .user").append('<p class="wins">Wins: '+s[0].value+"</p>"),e(".charts .user").append('<p class="ties">Ties: '+s[2].value+"</p>"),e(".charts .user").append('<p class="losses">Losses: '+s[1].value+"</p>")})}var n=e(this),o=""+(new Date).getTime(),i=[];e("td",n).each(function(s){e(this).data("position",s+1),i.push(s+1)}),e(n).after("<p id='msg_"+o+"' class='game_msg'>Make the first move.</p>"),e("td",n).click(function(){Game.is_over()||(e("p#msg_"+o).text(""),e(".controls").hide(),position=e(this).data("position"),Game.position_is_claimable(position)&&(Game.claim_position("player_a",position),e(this).addClass("user_claimed"),e(this).html("<span>X</span>"),Game.user_has_won("player_a")?e.ajax({url:"/results/win",data:{nonce:e("input#nonce").val(),user_id:e.cookie("ttt-rr")},error:function(s){e("p#msg_"+o).append(s.responseText+"<br />")},complete:function(){s("You won!")}}):(position=AI.get_move(Game.claimed_positions),Game.claim_position("player_b",position),e("td",n).filter(function(){e(this).data("position")&&e(this).data("position")==position&&(e(this).addClass("bot_claimed"),e(this).html("<span>O</span>"))})),Game.user_has_won("player_b")?e.ajax({url:"/results/loss",data:{nonce:e("input#nonce").val(),user_id:e.cookie("ttt-rr")},error:function(s){e("p#msg_"+o).append(s.responseText+"<br />")},complete:function(){s("You lost.")}}):Game.ended_in_tie()&&e.ajax({url:"/results/tie",data:{nonce:e("input#nonce").val(),user_id:e.cookie("ttt-rr")},error:function(s){e("p#msg_"+o).append(s.responseText+"<br />")},complete:function(){s("Draw")}})))}),e("input#beatable").click(function(){AI.beatable=e(this).is(":checked")})}})(jQuery);